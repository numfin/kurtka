{"version":3,"file":"index.js","sources":["../src/client/nodeHtml.ts","../src/client/makeReactive.ts","../src/client/nodeComponent.ts","../src/client/createNode.ts","../src/client/Component.ts","../src/client/Kurtka.ts","../src/client/createApp.ts"],"sourcesContent":["import { Tags } from \"./Tags\";\nimport { Attrs } from \"./Attrs\";\n\nexport function createNodeHtml(\n    tag: Tags,\n    attrs: Attrs,\n    children: Kurtka.Node[]\n): Kurtka.Node {\n    const el = document.createElement(tag);\n    if (attrs) {\n        const { events, style, ...attributes } = attrs;\n        Object.assign(el, attributes);\n        Object.assign(el.style, style);\n        Object.entries(events || {}).forEach(([event, handler]) => {\n            el.addEventListener(event, (...args) => handler(...args));\n        });\n    }\n\n    return function renderHtml() {\n        function replaceNodes(\n            root: HTMLElement | DocumentFragment,\n            childs: Kurtka.Node[]\n        ) {\n            childs.forEach((child, i) => {\n                let node;\n                if (typeof child === \"function\") {\n                    const c = child();\n                    if (Array.isArray(c)) {\n                        return replaceNodes(el, c);\n                    } else {\n                        node = c;\n                    }\n                } else {\n                    node = document.createTextNode(String(child));\n                }\n                const cached = root.childNodes[i];\n                if (cached) {\n                    if (!cached.isEqualNode(node)) {\n                        root.replaceChild(node, cached);\n                    }\n                } else {\n                    root.appendChild(node);\n                }\n            });\n        }\n        replaceNodes(el, children);\n        return el;\n    };\n}\n","export function makeReactive<T extends any>(item: T, reactFn: Function): T {\n    if (Array.isArray(item)) {\n        return new Proxy(\n            item.map((v: any) => makeReactive(v, reactFn)),\n            {\n                set(target, key, value) {\n                    if (key !== \"length\") {\n                        target[key as number] = makeReactive(value, reactFn);\n                        reactFn();\n                    }\n                    return true;\n                },\n            }\n        );\n    } else if (typeof item === \"object\") {\n        Object.entries(item).forEach(([k, v]) => {\n            item[k] = makeReactive(v, reactFn);\n        });\n        return new Proxy(item as any, {\n            set(target, key, value) {\n                target[key] = makeReactive(value, reactFn);\n                reactFn();\n                return true;\n            },\n        });\n    } else {\n        return item;\n    }\n}\n","import { Attrs } from \"./Attrs\";\nimport { makeReactive } from \"./makeReactive\";\n\nexport function createNodeComponent<T extends Attrs>(\n    C: new (attrs: T) => Kurtka.Component,\n    attrs: T\n): Kurtka.NodeComponent {\n    const component = new C(attrs);\n\n    const node = component.render();\n\n    if (component.state) {\n        component.state = makeReactive(component.state, node);\n    }\n\n    return function renderComponent() {\n        return node();\n    };\n}\n","import { createNodeHtml } from \"~/client/nodeHtml\";\nimport { createNodeComponent } from \"~/client/nodeComponent\";\nimport { Tags } from \"~/client/Tags\";\nimport { Attrs } from \"~/client/Attrs\";\n\nexport function createNode<T extends Attrs>(\n    tag: Tags | (new (p: T) => Kurtka.Component),\n    attrs: T,\n    ...children: Kurtka.Node[]\n): Kurtka.Node {\n    if (typeof tag === \"function\") {\n        return createNodeComponent(tag, attrs);\n    }\n    return createNodeHtml(tag, attrs, children);\n}\n","export class Component implements Kurtka.Component {\n  key = Symbol();\n  props?: Record<string, unknown> = {};\n  state?: Record<string, unknown>;\n\n  constructor() {}\n  render(): Kurtka.NodeHtml {\n    return null!;\n  }\n}\n\nexport const NodeType: Record<keyof typeof Kurtka.NodeType, string> = {\n  html: \"html\",\n  component: \"component\"\n};\n","import { createNode } from \"./createNode\";\nimport { Component, NodeType } from \"./Component\";\n\nexport const Kurtka = {\n  createNode,\n  Component,\n  NodeType\n};\n","export function createApp(app: Kurtka.NodeComponent, parent: Element) {\n    parent?.replaceWith(app());\n    return app;\n}\n"],"names":[],"mappings":"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"}